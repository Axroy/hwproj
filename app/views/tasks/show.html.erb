<div class="col-md-8">
  <h1>
  <% if @task.accepted? %>
    <span style="color:#5cb85c" class="glyphicon glyphicon-ok-sign"></span>
  <% elsif @task.accepted_partially? %>
    <span style="color:#f0ad4e" class="glyphicon glyphicon-exclamation-sign"></span>
  <% end %>
    Задача <%= @task.problem.homework.number %>.<%= @task.problem.number %> 
    <small> 
      <%= "#{@user.name} #{@user.surname}" %> 
      <%= " v.#{@submissions.first.version}" if @submissions.any? %>
    </small> 
  </h1>

  <div class="row"><div class="well well-small"> <%= @task.problem.text %> </div></div>

  <% if @task.submissions.any? %>
    <h3>Последнее решение</h3>
    <%= @last_submission.text %> <br>

    <% if @last_submission.file? %>
      <%= link_to "Скачать файл", @last_submission.file.url %>
    <% end %>
    
    <% if @task.notes.any? %>
      <h3> Замечания </h3>
          <% @task.notes.each do |note| %>
            <h5>
              <% if note.fixed? %>
                <span style="color:#5cb85c" class="glyphicon glyphicon-ok"></span>
              <% else %>
                <span style="color:#f0ad4e" class="glyphicon glyphicon-exclamation-sign"></span>
              <% end %>

              <%= note.text %>
              <small><strong><%= "v.#{note.submission.version}" %></strong><%=", #{note.created_at.strftime("%d.%m.%y")}" %></small> 

              <% if signed_in? && current_user.teacher? && (not note.fixed?) %>
                  <%= form_for note, method: :put do |f| %>
                    <%= f.hidden_field :id, value: note.id %>
                    <%= f.hidden_field :fixed, value: true %>
                    <%= f.submit "Исправлено", class: "btn btn-success btn-xs"%>
                  <% end %>
                <% end %>

            </h5>
          <% end %>
    <% end %>
  <% end %>

  <% if signed_in? && current_user.teacher? && (not @task.accepted?) && @submissions.any? %> <br> 
    
      <%= simple_form_for @last_submission, url: {controller: :submissions, action: :update} do |f| %>
        <%= f.hidden_field :id, value: @last_submission.id %>

          <br>
          <div class="links">
            <%= link_to_add_association 'Добавить замечание', f, :notes, class: "btn btn-warning" %>
            <%= f.submit "Сохранить замечания", class: "btn btn-default" %>
          </div>
          
          <br>

          <%= form_for @task, method: :put do |f| %>
            <%= f.hidden_field :status, value: "accepted" %>
            <%= f.submit "Принять решение", class: "btn btn-success" %>
          <% end %>
      <% end %>
  <% end %>

</div>
<div class="col-md-4">
<h1>Обсуждение</h1>
</div>